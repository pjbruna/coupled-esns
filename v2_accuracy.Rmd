---
title: "v2_accuracy"
author: "Polyphony J. Bruna"
date: "2025-01-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(viridis)
```

```{r}
performance_data <- read.csv("data/v2_s23_randreset_500_performance.csv") %>%
  filter(timestep!=1)
```

```{r}
# Check individual esn performance

performance_data %>%
  filter(model!="joint") %>%
  group_by(model, coupling, run_idx, signal_idx) %>%
  summarise(avg_sig_acc = mean(correct)) %>%
  group_by(coupling, signal_idx) %>%
  summarise(model, avg_over_runs = mean(avg_sig_acc)) %>%
  group_by(model, coupling) %>%
  summarise(m = mean(avg_over_runs), se = sd(avg_over_runs)/sqrt(n())) %>%
  filter(coupling==0)
```

```{r}
joint_esn_perf <- performance_data %>% 
  filter(model=="joint") %>%
  group_by(coupling, run_idx, signal_idx) %>%
  summarise(avg_sig_acc = mean(correct)) %>%
  group_by(coupling, signal_idx) %>%
  summarise(avg_over_runs = mean(avg_sig_acc)) %>%
  group_by(coupling) %>%
  summarise(m = mean(avg_over_runs), se = sd(avg_over_runs)/sqrt(n()))

ggplot(joint_esn_perf, aes(x=coupling, y=m)) +
  geom_point(alpha=0.5) +
  geom_ribbon(aes(ymin = m - se, ymax = m + se), alpha = 0.1, linetype = 0) +
  geom_line() +
  labs(x="Coupling", y="Accuracy (%)") +
  theme_bw()
```

```{r}
joint_perf_timeseries <- performance_data %>%
  filter(model=="joint") %>%
  group_by(coupling, run_idx, signal_idx) %>%
  mutate(norm_t = (timestep - min(timestep)) / (max(timestep) - min(timestep))) %>%
  mutate(norm_t = round(norm_t, 1) * 10) %>%
  group_by(coupling, run_idx, signal_idx) %>%
  arrange(norm_t, .by_group = TRUE) %>%
  mutate(cuml_cor = cumsum(correct),
         cuml_total = row_number(),
         cuml_acc = cuml_cor/cuml_total) %>%
  group_by(coupling, signal_idx, norm_t) %>%
  summarise(acc_over_runs = mean(cuml_acc)) %>%
  group_by(coupling, norm_t) %>%
  summarise(m = mean(acc_over_runs), se = sd(acc_over_runs)/sqrt(n()))

ggplot(joint_perf_timeseries, aes(x=norm_t, y=m)) +
  facet_wrap(~coupling) +
  geom_point(alpha=0.5) +
  geom_ribbon(aes(ymin = m - se, ymax = m + se), alpha = 0.1, linetype = 0) +
  geom_line() +
  labs(x="Time (normalized)", y="Accuracy (%)") +
  geom_hline(yintercept=0.5, linetype="dotted") +
  theme_bw()
```


